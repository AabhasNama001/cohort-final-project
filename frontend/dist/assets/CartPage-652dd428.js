import{r as l,C as _,u as z,a,j as t,F as E,b as q,c as B}from"./index-2b463f4e.js";function Q(){var w,N,v;const{cart:i,loadCart:c}=l.useContext(_),[h,g]=l.useState(!1),[P,u]=l.useState(!1),[n,p]=l.useState({street:"",city:"",state:"",pincode:"",country:""}),[x,$]=l.useState({}),A=z(),y="https://cohort-final-project-cart.onrender.com/api/cart",f=localStorage.getItem("token");l.useEffect(()=>{c()},[]);const O=()=>{const e={};return n.street||(e.street="Street is required"),n.city||(e.city="City is required"),n.state||(e.state="State is required"),(!n.pincode||!/^\d{4,}$/.test(n.pincode))&&(e.pincode="Pincode must be at least 4 digits"),n.country||(e.country="Country is required"),$(e),Object.keys(e).length===0},b=async(e,s)=>{var r;try{s<=0?await q.delete(`${y}/items/${e}`,{headers:{Authorization:`Bearer ${f}`},withCredentials:!0}):await q.patch(`${y}/items/${e}`,{qty:s},{headers:{Authorization:`Bearer ${f}`},withCredentials:!0}),await c()}catch(o){console.error("Quantity update failed:",o),((r=o.response)==null?void 0:r.status)===401&&alert("Session expired. Please log in again.")}},F=async()=>{var e,s;if(O()){g(!0);try{const r={shippingAddress:{...n}};await B(r),alert("âœ… Order placed successfully!"),u(!1),p({street:"",city:"",state:"",pincode:"",country:""}),await c(),A("/orders")}catch(r){console.error("Checkout error:",r),alert("Checkout failed: "+(((s=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:s.message)||r.message))}finally{g(!1)}}},U=(w=i==null?void 0:i.items)==null?void 0:w.reduce((e,s)=>e+(s.quantity??1),0),m=(N=i==null?void 0:i.items)==null?void 0:N.reduce((e,s)=>{var r,o;return e+(((o=(r=s.productId)==null?void 0:r.price)==null?void 0:o.amount)??0)*(s.quantity??1)},0);return a("div",{className:"min-h-screen bg-[#fefde6] p-4 sm:p-8",children:[a("div",{className:"max-w-5xl mx-auto bg-[#fffdf5] rounded-3xl shadow-lg p-6 sm:p-8 border border-gray-100",children:[t("h2",{className:"text-2xl sm:text-3xl font-extrabold text-gray-800 mb-8 text-center",children:"ðŸ›’ Your Shopping Cart"}),(v=i==null?void 0:i.items)!=null&&v.length?a(E,{children:[t("ul",{className:"divide-y divide-gray-200",children:i.items.map((e,s)=>{var r,o,C,k,j,S,I;return a("li",{className:"py-4 flex flex-col sm:flex-row justify-between items-center sm:items-center gap-4 sm:gap-8 hover:bg-gray-50/70 rounded-xl transition-all duration-300",children:[a("div",{className:"flex items-center gap-4 w-full sm:w-auto",children:[t("img",{src:((r=e.productId)==null?void 0:r.image)||"https://placehold.co/80x80?text=No+Image",alt:((o=e.productId)==null?void 0:o.title)||"Product",className:"w-20 h-20 object-cover rounded-lg border"}),a("div",{className:"flex flex-col",children:[t("span",{className:"font-semibold text-gray-900 text-lg",children:((C=e.productId)==null?void 0:C.title)||"Untitled Product"}),a("span",{className:"text-gray-600 text-sm",children:["â‚¹",((j=(k=e.productId)==null?void 0:k.price)==null?void 0:j.amount)??"-"]})]})]}),a("div",{className:"flex items-center justify-between w-full sm:w-auto gap-4",children:[a("div",{className:"flex items-center gap-3",children:[t("button",{onClick:()=>{var d;return b((d=e.productId)==null?void 0:d._id,e.quantity-1)},className:"px-3 py-1 bg-gray-200 rounded-md text-lg hover:bg-gray-300 transition",children:"âˆ’"}),t("span",{className:"font-medium",children:e.quantity??1}),t("button",{onClick:()=>{var d;return b((d=e.productId)==null?void 0:d._id,e.quantity+1)},className:"px-3 py-1 bg-gray-200 rounded-md text-lg hover:bg-gray-300 transition",children:"+"})]}),a("div",{className:"font-semibold text-indigo-600",children:["â‚¹",((((I=(S=e.productId)==null?void 0:S.price)==null?void 0:I.amount)??0)*(e.quantity??1)).toFixed(2)]})]})]},e._id||s)})}),a("div",{className:"mt-8 flex flex-col lg:flex-row justify-between items-center gap-6",children:[a("div",{className:"bg-white rounded-2xl shadow-md p-6 w-full lg:w-1/2 border",children:[t("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:"Order Summary"}),a("div",{className:"flex justify-between mb-2 text-gray-700",children:[t("span",{children:"Total Items:"}),t("span",{children:U})]}),a("div",{className:"flex justify-between text-gray-700",children:[t("span",{children:"Total Price:"}),a("span",{className:"font-semibold text-indigo-600",children:["â‚¹",m==null?void 0:m.toFixed(2)]})]})]}),a("div",{className:"flex gap-4",children:[t("button",{onClick:c,className:"px-5 py-2 border border-gray-300 rounded-xl text-gray-700 hover:bg-gray-100 transition-all duration-200",children:"Refresh"}),t("button",{onClick:()=>u(!0),className:"px-6 py-2 rounded-xl font-semibold bg-gradient-to-r from-green-500 to-emerald-600 text-white shadow-md hover:shadow-lg transition-all duration-300",children:"Proceed to Checkout"})]})]})]}):t("div",{className:"text-center py-20 text-gray-500 text-lg",children:"ðŸ•“ Your cart is empty. Start adding some awesome products!"})]}),P&&t("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center backdrop-blur-sm p-4",children:a("div",{className:"bg-white rounded-3xl p-8 w-full max-w-lg shadow-2xl relative animate-fadeInUp",children:[t("h3",{className:"text-2xl font-bold text-gray-800 mb-4 text-center",children:"Shipping Address"}),t("div",{className:"space-y-3",children:["street","city","state","pincode","country"].map(e=>a("div",{children:[t("input",{value:n[e],onChange:s=>p({...n,[e]:s.target.value}),placeholder:e.charAt(0).toUpperCase()+e.slice(1),className:"w-full p-3 rounded-xl border border-gray-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-300 outline-none transition"}),x[e]&&t("div",{className:"text-red-600 text-sm mt-1",children:x[e]})]},e))}),a("div",{className:"mt-6 flex justify-end gap-3",children:[t("button",{onClick:()=>u(!1),className:"px-4 py-2 border border-gray-300 rounded-xl hover:bg-gray-100 transition-all",children:"Cancel"}),t("button",{disabled:h,onClick:F,className:"px-6 py-2 rounded-xl bg-gradient-to-r from-green-500 to-emerald-600 text-white font-semibold shadow hover:shadow-lg disabled:opacity-60 transition-all",children:h?"Placing...":"Place Order"})]})]})})]})}export{Q as default};
