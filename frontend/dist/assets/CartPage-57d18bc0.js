import{r as l,C as A,u as F,a,j as t,F as Y,b as $,c as z}from"./index-f37cab1a.js";function L(){var b,f;const{cart:n,loadCart:c}=l.useContext(A),[p,h]=l.useState(!1),[j,u]=l.useState(!1),[o,g]=l.useState({street:"",city:"",state:"",pincode:"",country:""}),[x,S]=l.useState({}),q=F(),I="https://cohort-final-project-cart.onrender.com/api/cart",P=localStorage.getItem("token"),U=()=>{const e={};return o.street||(e.street="Street is required"),o.city||(e.city="City is required"),o.state||(e.state="State is required"),(!o.pincode||!/^\d{4,}$/.test(o.pincode))&&(e.pincode="Pincode must be at least 4 digits"),o.country||(e.country="Country is required"),S(e),Object.keys(e).length===0},y=async(e,s)=>{var r;if(!(s<1))try{await $.patch(`${I}/items/${e}`,{qty:s},{headers:{Authorization:`Bearer ${P}`},withCredentials:!0}),await c()}catch(i){console.error("Quantity update failed:",i),((r=i.response)==null?void 0:r.status)===401&&alert("Session expired. Please log in again.")}},_=async()=>{var e,s;if(U()){h(!0);try{const r={shippingAddress:{...o}};await z(r),alert("âœ… Order placed successfully!"),u(!1),g({street:"",city:"",state:"",pincode:"",country:""}),await c(),q("/orders")}catch(r){console.error("Checkout error:",r),alert("Checkout failed: "+(((s=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:s.message)||r.message))}finally{h(!1)}}},O=(b=n==null?void 0:n.items)==null?void 0:b.reduce((e,s)=>e+(s.quantity??1),0),m=(f=n==null?void 0:n.items)==null?void 0:f.reduce((e,s)=>{var r,i;return e+(((i=(r=s.product)==null?void 0:r.price)==null?void 0:i.amount)??0)*(s.quantity??1)},0);return a("div",{className:"min-h-screen bg-[#efefbf] p-8",children:[a("div",{className:"max-w-5xl mx-auto bg-[#f5f5dd] rounded-3xl shadow-2xl p-8 border border-gray-100",children:[t("h2",{className:"text-3xl font-extrabold text-gray-800 mb-8 text-center",children:"ðŸ›’ Your Shopping Cart"}),n.items&&n.items.length?a(Y,{children:[t("ul",{className:"divide-y divide-gray-200",children:n.items.map((e,s)=>{var r,i,v,N,w,C,k;return a("li",{className:"py-4 px-4 flex justify-between items-center hover:bg-gray-50/70 rounded-xl transition-all duration-300",children:[a("div",{className:"flex items-center gap-4",children:[t("img",{src:((r=e.product)==null?void 0:r.image)||"https://placehold.co/80x80?text=No+Image",alt:((i=e.product)==null?void 0:i.title)||"Product",className:"w-20 h-20 object-cover rounded-lg border"}),a("div",{children:[t("div",{className:"font-semibold text-gray-900 text-lg",children:((v=e.product)==null?void 0:v.title)||"Untitled Product"}),a("div",{className:"text-gray-600 text-sm",children:["â‚¹",((w=(N=e.product)==null?void 0:N.price)==null?void 0:w.amount)??"-"]})]})]}),a("div",{className:"flex items-center gap-3",children:[t("button",{onClick:()=>{var d;return y(e.productId||((d=e.product)==null?void 0:d._id),(e.quantity??1)-1)},className:"px-3 py-1 bg-gray-200 rounded-md text-lg hover:bg-gray-300 transition",children:"âˆ’"}),t("span",{className:"font-medium",children:e.quantity??1}),t("button",{onClick:()=>{var d;return y(e.productId||((d=e.product)==null?void 0:d._id),(e.quantity??1)+1)},className:"px-3 py-1 bg-gray-200 rounded-md text-lg hover:bg-gray-300 transition",children:"+"})]}),a("div",{className:"font-semibold text-indigo-600",children:["â‚¹",((((k=(C=e.product)==null?void 0:C.price)==null?void 0:k.amount)??0)*(e.quantity??1)).toFixed(2)]})]},e._id||s)})}),a("div",{className:"mt-8 flex flex-col sm:flex-row justify-between items-center gap-6",children:[a("div",{className:"bg-white rounded-2xl shadow-md p-6 w-full sm:w-1/2 border",children:[t("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:"Order Summary"}),a("div",{className:"flex justify-between mb-2 text-gray-700",children:[t("span",{children:"Total Items:"}),t("span",{children:O})]}),a("div",{className:"flex justify-between mb-2 text-gray-700",children:[t("span",{children:"Total Price:"}),a("span",{className:"font-semibold text-indigo-600",children:["â‚¹",m==null?void 0:m.toFixed(2)]})]})]}),a("div",{className:"flex gap-4",children:[t("button",{onClick:c,className:"px-5 py-2 border border-gray-300 rounded-xl text-gray-700 hover:bg-gray-100 transition-all duration-200",children:"Refresh"}),t("button",{onClick:()=>u(!0),className:"px-6 py-2 rounded-xl font-semibold bg-gradient-to-r from-green-500 to-emerald-600 text-white shadow-md hover:shadow-lg transition-all duration-300",children:"Proceed to Checkout"})]})]})]}):t("div",{className:"text-center py-20 text-gray-500 text-lg",children:"ðŸ•“ Your cart is empty. Start adding some awesome products!"})]}),j&&a("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center backdrop-blur-sm p-4",children:[a("div",{className:"bg-white rounded-3xl p-8 w-full max-w-lg shadow-2xl relative animate-fadeInUp",children:[t("h3",{className:"text-2xl font-bold text-gray-800 mb-4 text-center",children:"Shipping Address"}),t("div",{className:"space-y-3",children:["street","city","state","pincode","country"].map(e=>a("div",{children:[t("input",{value:o[e],onChange:s=>g({...o,[e]:s.target.value}),placeholder:e.charAt(0).toUpperCase()+e.slice(1),className:"w-full p-3 rounded-xl border border-gray-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-300 outline-none transition"}),x[e]&&t("div",{className:"text-red-600 text-sm mt-1",children:x[e]})]},e))}),a("div",{className:"mt-6 flex justify-end gap-3",children:[t("button",{onClick:()=>u(!1),className:"px-4 py-2 border border-gray-300 rounded-xl hover:bg-gray-100 transition-all",children:"Cancel"}),t("button",{disabled:p,onClick:_,className:"px-6 py-2 rounded-xl bg-gradient-to-r from-green-500 to-emerald-600 text-white font-semibold shadow hover:shadow-lg disabled:opacity-60 transition-all",children:p?"Placing...":"Place Order"})]}),t("div",{className:"absolute inset-0 rounded-3xl border border-transparent hover:border-indigo-400/50 hover:shadow-[0_0_20px_rgba(99,102,241,0.3)] transition-all duration-300 pointer-events-none"})]}),t("style",{jsx:!0,children:`
            @keyframes fadeInUp {
              from {
                opacity: 0;
                transform: translateY(20px);
              }
              to {
                opacity: 1;
                transform: translateY(0);
              }
            }
            .animate-fadeInUp {
              animation: fadeInUp 0.4s ease both;
            }
          `})]})]})}export{L as default};
